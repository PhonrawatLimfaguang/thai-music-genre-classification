# -*- coding: utf-8 -*-
"""Project DE242 Music Genre Classification.ipynb

Automatically generated by Colab.

Original file is located at
    https://colab.research.google.com/drive/1JQfBHv8CFhJHTpeudLfZ88Kex__fO3Kq

<h1>‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏° Dataset
"""

from google.colab import drive
drive.mount('/content/drive/')

"""<h1>‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÇ‡∏ü‡∏•‡πÄ‡∏î‡∏≠‡∏£‡πå‡πÅ‡∏¢‡∏Å genres"""

import os

base_dir = "/content/drive/My Drive/Project DE242 Music Genre Classification/Dataset"
genres = ["Northern song", "Northeastern song", "Southern song", "Central song"]


for genre in genres:
    os.makedirs(os.path.join(base_dir, genre), exist_ok=True)

print("‚úÖ ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÇ‡∏ü‡∏•‡πÄ‡∏î‡∏≠‡∏£‡πå‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!")

base_dir = "/content/drive/My Drive/Project DE242 Music Genre Classification/Dataset"
genres = ["Northern song", "Northeastern song", "Southern song", "Central song"]

from sklearn.model_selection import train_test_split
from sklearn.ensemble import RandomForestClassifier
from sklearn.metrics import accuracy_score
import librosa
import pandas as pd
import numpy as np
import os

"""<h1>‡πÅ‡∏õ‡∏•‡∏á‡πÑ‡∏ü‡∏•‡πå‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡πÄ‡∏õ‡πá‡∏ô .wav ‡πÅ‡∏•‡∏∞‡∏õ‡∏£‡∏±‡∏ö Sample Rate & Mono/Stereo

‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡πÅ‡∏õ‡∏•‡∏á‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡∏à‡∏≤‡∏Å MP3 ‡πÄ‡∏õ‡πá‡∏ô‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö WAV
"""

!apt-get install ffmpeg -y

!pip install pydub
from pydub import AudioSegment
from pydub.utils import which

AudioSegment.converter = which("ffmpeg")  # ‡∏ö‡∏≠‡∏Å‡πÉ‡∏´‡πâ pydub ‡πÉ‡∏ä‡πâ ffmpeg

from pydub import AudioSegment
import os

base_dir = "/content/drive/My Drive/Project DE242 Music Genre Classification/Dataset"
output_dir = "/content/drive/My Drive/Project DE242 Music Genre Classification/Dataset_WAV"

for genre in genres:
    input_folder = os.path.join(base_dir, genre)
    output_folder = os.path.join(output_dir, genre)
    os.makedirs(output_folder, exist_ok=True)

    for file in os.listdir(input_folder):
        if file.endswith(".mp3"):
            mp3_path = os.path.join(input_folder, file)
            wav_path = os.path.join(output_folder, file.replace(".mp3", ".wav"))

            audio = AudioSegment.from_mp3(mp3_path)
            audio = audio.set_frame_rate(22050).set_channels(1)  # ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ Sample Rate & Mono
            audio.export(wav_path, format="wav")

    print(f"‚úÖ ‡πÅ‡∏õ‡∏•‡∏á‡πÑ‡∏ü‡∏•‡πå {genre} ‡πÄ‡∏™‡∏£‡πá‡∏à‡πÅ‡∏•‡πâ‡∏ß!")

"""<h1>‡∏ï‡∏±‡∏î‡∏ó‡∏∏‡∏Å‡πÄ‡∏û‡∏•‡∏á‡πÉ‡∏ô‡πÇ‡∏ü‡∏•‡πÄ‡∏î‡∏≠‡∏£‡πå‡πÉ‡∏´‡πâ‡∏™‡∏±‡πâ‡∏ô‡∏•‡∏á ‡∏ï‡∏±‡∏î‡πÅ‡∏ö‡∏ö30‡∏ß‡∏¥‡πÅ‡∏£‡∏Å"""

from pydub import AudioSegment
import os

# ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡πÇ‡∏ü‡∏•‡πÄ‡∏î‡∏≠‡∏£‡πå
base_dir = "/content/drive/My Drive/Project DE242 Music Genre Classification/Dataset_WAV"
output_dir = "/content/drive/My Drive/Project DE242 Music Genre Classification/Dataset_Cropped"

# ‡∏ï‡∏±‡πâ‡∏á‡πÄ‡∏ß‡∏•‡∏≤‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡∏î (‡∏°‡∏¥‡∏•‡∏•‡∏¥‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ)
duration_ms = 30 * 1000  # 30 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ

# ‡∏ß‡∏ô‡∏•‡∏π‡∏õ‡∏ï‡∏±‡∏î‡πÄ‡∏û‡∏•‡∏á‡πÉ‡∏ô‡∏ó‡∏∏‡∏Å‡πÇ‡∏ü‡∏•‡πÄ‡∏î‡∏≠‡∏£‡πå
genres = ["Northern song", "Northeastern song", "Southern song", "Central song"]
for genre in genres:
    input_folder = os.path.join(base_dir, genre)
    output_folder = os.path.join(output_dir, genre)
    os.makedirs(output_folder, exist_ok=True)

    for file in os.listdir(input_folder):
        if file.endswith(".wav"):
            file_path = os.path.join(input_folder, file)
            output_path = os.path.join(output_folder, file)

            # ‡πÇ‡∏´‡∏•‡∏î‡πÑ‡∏ü‡∏•‡πå‡πÄ‡∏™‡∏µ‡∏¢‡∏á
            audio = AudioSegment.from_wav(file_path)

            # ‡∏ï‡∏±‡∏î‡∏ä‡πà‡∏ß‡∏á 30 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ‡πÅ‡∏£‡∏Å
            cropped_audio = audio[:duration_ms]

            # ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÑ‡∏ü‡∏•‡πå‡πÉ‡∏´‡∏°‡πà
            cropped_audio.export(output_path, format="wav")

    print(f"‚úÖ ‡∏ï‡∏±‡∏î‡πÄ‡∏û‡∏•‡∏á‡πÉ‡∏ô {genre} ‡πÄ‡∏™‡∏£‡πá‡∏à‡πÅ‡∏•‡πâ‡∏ß!")

"""<h1>‡∏ï‡∏±‡∏î‡∏ó‡∏∏‡∏Å‡πÄ‡∏û‡∏•‡∏á‡πÉ‡∏ô‡πÇ‡∏ü‡∏•‡πÄ‡∏î‡∏≠‡∏£‡πå‡πÉ‡∏´‡πâ‡∏™‡∏±‡πâ‡∏ô‡∏•‡∏á ‡∏ï‡∏±‡∏î‡πÄ‡∏û‡∏•‡∏á‡πÄ‡∏õ‡πá‡∏ô‡∏ä‡πà‡∏ß‡∏á‡πÜ‡πÄ‡∏•‡∏∑‡πà‡∏≠‡∏ô‡∏ó‡∏µ‡∏•‡∏∞ 15 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ"""

import os
from pydub import AudioSegment

# ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏û‡∏≤‡∏£‡∏≤‡∏°‡∏¥‡πÄ‡∏ï‡∏≠‡∏£‡πå
input_dir = "/content/drive/My Drive/Project DE242 Music Genre Classification/Dataset_WAV"
output_dir = "/content/drive/My Drive/Project DE242 Music Genre Classification/Dataset_Segments"

window_size = 30000  # 30 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ
step_size = 15000    # 15 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ (Overlap 50%)

# ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÇ‡∏ü‡∏•‡πÄ‡∏î‡∏≠‡∏£‡πå‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÄ‡∏Å‡πá‡∏ö‡πÑ‡∏ü‡∏•‡πå‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡∏±‡∏î
os.makedirs(output_dir, exist_ok=True)

# ‡∏ß‡∏ô‡∏•‡∏π‡∏õ‡∏ú‡πà‡∏≤‡∏ô‡∏ó‡∏∏‡∏Å‡πÅ‡∏ô‡∏ß‡πÄ‡∏û‡∏•‡∏á
for genre in os.listdir(input_dir):
    genre_folder = os.path.join(input_dir, genre)
    output_genre_folder = os.path.join(output_dir, genre)

    # ‡∏Ç‡πâ‡∏≤‡∏°‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πà‡πÇ‡∏ü‡∏•‡πÄ‡∏î‡∏≠‡∏£‡πå
    if not os.path.isdir(genre_folder):
        continue

    os.makedirs(output_genre_folder, exist_ok=True)  # ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÇ‡∏ü‡∏•‡πÄ‡∏î‡∏≠‡∏£‡πå‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÄ‡∏Å‡πá‡∏ö segment

    # ‡∏ß‡∏ô‡∏•‡∏π‡∏õ‡∏ú‡πà‡∏≤‡∏ô‡πÑ‡∏ü‡∏•‡πå‡πÄ‡∏û‡∏•‡∏á‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡πÉ‡∏ô‡πÅ‡∏ï‡πà‡∏•‡∏∞‡πÅ‡∏ô‡∏ß‡πÄ‡∏û‡∏•‡∏á
    for file in os.listdir(genre_folder):
        if file.endswith(".wav"):
            file_path = os.path.join(genre_folder, file)
            audio = AudioSegment.from_wav(file_path)

            # ‡∏ï‡∏±‡∏î‡πÄ‡∏û‡∏•‡∏á‡πÄ‡∏õ‡πá‡∏ô segment
            segments = []
            for start in range(0, len(audio) - window_size, step_size):
                segment = audio[start:start + window_size]
                segments.append(segment)

            # ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å segment ‡∏•‡∏á‡πÇ‡∏ü‡∏•‡πÄ‡∏î‡∏≠‡∏£‡πå output
            for i, segment in enumerate(segments):
                segment_path = os.path.join(output_genre_folder, f"{file.replace('.wav', '')}_seg{i}.wav")
                segment.export(segment_path, format="wav")

    print(f"‚úÖ ‡∏ï‡∏±‡∏î‡πÄ‡∏û‡∏•‡∏á‡πÉ‡∏ô {genre} ‡πÄ‡∏™‡∏£‡πá‡∏à‡πÅ‡∏•‡πâ‡∏ß!")

"""<h1>‡∏î‡∏∂‡∏á Chroma Features ‡πÅ‡∏•‡∏∞ Spectral Contrast"""

import librosa
import numpy as np
import os

dataset_dir = "/content/drive/My Drive/Project DE242 Music Genre Classification/Dataset_Segments"
features_list = []

for genre in os.listdir(dataset_dir):
    genre_folder = os.path.join(dataset_dir, genre)

    if os.path.isdir(genre_folder):  # ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤‡πÄ‡∏õ‡πá‡∏ô‡πÇ‡∏ü‡∏•‡πÄ‡∏î‡∏≠‡∏£‡πå‡∏à‡∏£‡∏¥‡∏á ‡πÜ
        for file in os.listdir(genre_folder):
            if file.endswith(".wav"):  # ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤‡πÄ‡∏õ‡πá‡∏ô‡πÑ‡∏ü‡∏•‡πå‡πÄ‡∏™‡∏µ‡∏¢‡∏á
                file_path = os.path.join(genre_folder, file)

                # ‡πÇ‡∏´‡∏•‡∏î‡πÑ‡∏ü‡∏•‡πå‡πÄ‡∏™‡∏µ‡∏¢‡∏á
                y, sr = librosa.load(file_path, sr=22050)

                # ‡∏î‡∏∂‡∏á‡∏ü‡∏µ‡πÄ‡∏à‡∏≠‡∏£‡πå‡∏ï‡πà‡∏≤‡∏á ‡πÜ
                mfcc = librosa.feature.mfcc(y=y, sr=sr, n_mfcc=13).mean(axis=1)
                chroma = librosa.feature.chroma_stft(y=y, sr=sr).mean(axis=1)
                spectral_contrast = librosa.feature.spectral_contrast(y=y, sr=sr).mean(axis=1)

                # ‡∏£‡∏ß‡∏°‡∏ó‡∏∏‡∏Å‡∏ü‡∏µ‡πÄ‡∏à‡∏≠‡∏£‡πå‡πÄ‡∏Ç‡πâ‡∏≤‡∏î‡πâ‡∏ß‡∏¢‡∏Å‡∏±‡∏ô
                features = np.hstack([mfcc, chroma, spectral_contrast])

                # ‡πÄ‡∏Å‡πá‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
                features_list.append(features)

print(f"‚úÖ Extracted Features from {len(features_list)} files!")

"""<h1>‡πÅ‡∏õ‡∏•‡∏á‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡πÄ‡∏õ‡πá‡∏ô MFCC (Mel-Frequency Cepstral Coefficients)"""

import pandas as pd
import os

dataset = []
labels = []
genres = ["Northern song", "Northeastern song", "Southern song", "Central song"]  # ‡∏†‡∏≤‡∏Ñ‡∏ï‡πà‡∏≤‡∏á‡πÜ
dataset_path = "/content/drive/My Drive/Project DE242 Music Genre Classification/Dataset_Segments"  # ‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡πÑ‡∏ü‡∏•‡πå‡πÄ‡∏™‡∏µ‡∏¢‡∏á

for genre in genres:
    genre_folder = os.path.join(dataset_path, genre)

    for file in os.listdir(genre_folder):
        if file.endswith(".wav"):
            file_path = os.path.join(genre_folder, file)
            y, sr = librosa.load(file_path, sr=22050)

            # ‡∏î‡∏∂‡∏á Features
            mfcc = librosa.feature.mfcc(y=y, sr=sr, n_mfcc=13).mean(axis=1)
            chroma = librosa.feature.chroma_stft(y=y, sr=sr).mean(axis=1)
            spectral_contrast = librosa.feature.spectral_contrast(y=y, sr=sr).mean(axis=1)

            # ‡∏£‡∏ß‡∏° Features
            features = np.hstack([mfcc, chroma, spectral_contrast])
            dataset.append(features)
            labels.append(genre)

# ‡∏™‡∏£‡πâ‡∏≤‡∏á DataFrame
df = pd.DataFrame(dataset)
df["label"] = labels

# ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÄ‡∏õ‡πá‡∏ô CSV
df.to_csv("thai_music_dataset.csv", index=False)
print("‚úÖ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å dataset ‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢!")

"""<h1>‡πÄ‡∏ó‡∏£‡∏ô‡πÇ‡∏°‡πÄ‡∏î‡∏•‡πÅ‡∏¢‡∏Å‡πÅ‡∏ô‡∏ß‡πÄ‡∏û‡∏•‡∏á‡∏î‡πâ‡∏ß‡∏¢ Machine Learning (Random Forest)"""

from sklearn.model_selection import train_test_split
from sklearn.ensemble import RandomForestClassifier
from sklearn.metrics import accuracy_score

df = pd.read_csv("thai_music_dataset.csv")

X = df.iloc[:, :-1]  # Feature (MFCC)
y = df["label"]  # Label (Genre)

X_train, X_test, y_train, y_test = train_test_split(X, y, test_size=0.2, random_state=42)

model = RandomForestClassifier(n_estimators=100)
model.fit(X_train, y_train)

y_pred = model.predict(X_test)
accuracy = accuracy_score(y_test, y_pred)

print(f"üéØ Accuracy: {accuracy:.2f}")

"""<h1>Confusion Matrix"""

import numpy as np
import seaborn as sns
import matplotlib.pyplot as plt
from sklearn.metrics import confusion_matrix

# ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤ y_pred ‡πÄ‡∏õ‡πá‡∏ô 1D ‡∏´‡∏£‡∏∑‡∏≠ 2D
if len(y_pred.shape) > 1:
    y_pred_classes = np.argmax(y_pred, axis=1)  # ‡∏ñ‡πâ‡∏≤‡πÄ‡∏õ‡πá‡∏ô 2D ‚Üí argmax
else:
    y_pred_classes = y_pred  # ‡∏ñ‡πâ‡∏≤‡πÄ‡∏õ‡πá‡∏ô 1D ‚Üí ‡πÉ‡∏ä‡πâ‡πÄ‡∏•‡∏¢

# ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤ y_test ‡πÄ‡∏õ‡πá‡∏ô 1D ‡∏´‡∏£‡∏∑‡∏≠ 2D
if len(y_test.shape) > 1:
    y_true = np.argmax(y_test, axis=1)
else:
    y_true = y_test

# ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì Confusion Matrix
cm = confusion_matrix(y_true, y_pred_classes)

# ‡πÅ‡∏™‡∏î‡∏á Confusion Matrix
plt.figure(figsize=(6, 5))
sns.heatmap(cm, annot=True, fmt="d", cmap="Blues", xticklabels=genres, yticklabels=genres)
plt.xlabel("Predicted")
plt.ylabel("Actual")
plt.title("Confusion Matrix")
plt.show()

"""<h1>Precision, Recall ‡πÅ‡∏•‡∏∞ F1-Score

"""

from sklearn.metrics import classification_report

print(classification_report(y_true, y_pred_classes, target_names=genres))

"""<h1>‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÇ‡∏°‡πÄ‡∏î‡∏•"""

import joblib

# ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÇ‡∏°‡πÄ‡∏î‡∏•
joblib.dump(model, "/content/drive/My Drive/Project DE242 Music Genre Classification/random_forest_model.pkl")

print("‚úÖ ‡πÇ‡∏°‡πÄ‡∏î‡∏•‡∏ñ‡∏π‡∏Å‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢!")

"""<h1>‡πÅ‡∏õ‡∏•‡∏á‡πÄ‡∏û‡∏•‡∏á‡∏ó‡∏µ‡πà‡∏à‡∏∞‡πÉ‡∏´‡πâtest‡πÄ‡∏õ‡πá‡∏ô.wav"""

from pydub import AudioSegment
import os

# ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡πà‡∏ô‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÅ‡∏õ‡∏•‡∏á‡πÑ‡∏ü‡∏•‡πå .mp3 ‡πÄ‡∏õ‡πá‡∏ô .wav
def convert_mp3_to_wav(mp3_path, wav_path):
    audio = AudioSegment.from_mp3(mp3_path)
    audio = audio.set_frame_rate(22050).set_channels(1)  # ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ Sample Rate ‡πÅ‡∏•‡∏∞ Mono
    audio.export(wav_path, format="wav")
    print(f"‚úÖ ‡πÅ‡∏õ‡∏•‡∏á‡πÑ‡∏ü‡∏•‡πå {mp3_path} ‡πÄ‡∏õ‡πá‡∏ô {wav_path} ‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢!")

# ‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡πÄ‡∏™‡πâ‡∏ô‡∏ó‡∏≤‡∏á‡∏Ç‡∏≠‡∏á‡πÑ‡∏ü‡∏•‡πå
mp3_folder = "/content/drive/My Drive/Project DE242 Music Genre Classification/Unseen_Data"  # ‡πÇ‡∏ü‡∏•‡πÄ‡∏î‡∏≠‡∏£‡πå‡∏ó‡∏µ‡πà‡πÄ‡∏Å‡πá‡∏ö‡πÑ‡∏ü‡∏•‡πå .mp3
output_folder = "/content/drive/My Drive/Project DE242 Music Genre Classification/Unseen_Data_WAV"  # ‡πÇ‡∏ü‡∏•‡πÄ‡∏î‡∏≠‡∏£‡πå‡∏ó‡∏µ‡πà‡∏à‡∏∞‡πÄ‡∏Å‡πá‡∏ö‡πÑ‡∏ü‡∏•‡πå .wav

# ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÇ‡∏ü‡∏•‡πÄ‡∏î‡∏≠‡∏£‡πå‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÑ‡∏ü‡∏•‡πå .wav ‡∏ñ‡πâ‡∏≤‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ
os.makedirs(output_folder, exist_ok=True)

# ‡πÅ‡∏õ‡∏•‡∏á‡πÑ‡∏ü‡∏•‡πå‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡πÉ‡∏ô‡πÇ‡∏ü‡∏•‡πÄ‡∏î‡∏≠‡∏£‡πå .mp3 ‡πÄ‡∏õ‡πá‡∏ô .wav
for file in os.listdir(mp3_folder):
    if file.endswith(".mp3"):
        mp3_path = os.path.join(mp3_folder, file)
        wav_path = os.path.join(output_folder, file.replace(".mp3", ".wav"))
        convert_mp3_to_wav(mp3_path, wav_path)

print("‚úÖ ‡∏Å‡∏≤‡∏£‡πÅ‡∏õ‡∏•‡∏á‡πÑ‡∏ü‡∏•‡πå‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡∏¥‡πâ‡∏ô!")

"""<h1>‡∏Å‡∏≤‡∏£‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏Å‡∏±‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡πÑ‡∏°‡πà‡πÄ‡∏Ñ‡∏¢‡πÄ‡∏´‡πá‡∏ô‡∏°‡∏≤‡∏Å‡πà‡∏≠‡∏ô (Unseen Data)"""

import librosa
import numpy as np
import joblib  # ‡πÉ‡∏ä‡πâ joblib ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÇ‡∏´‡∏•‡∏î‡πÇ‡∏°‡πÄ‡∏î‡∏•‡∏ó‡∏µ‡πà‡∏ù‡∏∂‡∏Å‡πÑ‡∏ß‡πâ
import os

# ‡πÇ‡∏´‡∏•‡∏î‡πÇ‡∏°‡πÄ‡∏î‡∏•‡∏ó‡∏µ‡πà‡πÄ‡∏ó‡∏£‡∏ô‡πÑ‡∏ß‡πâ (Random Forest)
model = joblib.load("/content/drive/My Drive/Project DE242 Music Genre Classification/random_forest_model.pkl")

# ‡∏Å‡∏≥‡∏´‡∏ô‡∏î label ‡∏Ç‡∏≠‡∏á‡πÅ‡∏ô‡∏ß‡πÄ‡∏û‡∏•‡∏á
genres = ["Northern song", "Northeastern song", "Southern song", "Central song"]

# ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏î‡∏∂‡∏á‡∏ü‡∏µ‡πÄ‡∏à‡∏≠‡∏£‡πå‡πÄ‡∏™‡∏µ‡∏¢‡∏á
def extract_features(file_path):
    y, sr = librosa.load(file_path, sr=22050)

    # ‡∏î‡∏∂‡∏á MFCC, Chroma, Spectral Contrast
    mfcc = librosa.feature.mfcc(y=y, sr=sr, n_mfcc=13).mean(axis=1)
    chroma = librosa.feature.chroma_stft(y=y, sr=sr).mean(axis=1)
    spectral_contrast = librosa.feature.spectral_contrast(y=y, sr=sr).mean(axis=1)

    # ‡∏£‡∏ß‡∏°‡∏ü‡∏µ‡πÄ‡∏à‡∏≠‡∏£‡πå‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
    features = np.hstack([mfcc, chroma, spectral_contrast])
    return features

# üìÇ ‡πÇ‡∏ü‡∏•‡πÄ‡∏î‡∏≠‡∏£‡πå‡πÄ‡∏Å‡πá‡∏ö‡πÄ‡∏û‡∏•‡∏á‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ‡∏ó‡∏î‡∏™‡∏≠‡∏ö (Unseen Data)
test_folder = "/content/drive/My Drive/Project DE242 Music Genre Classification/Unseen_Data_WAV"

# ‡∏ß‡∏ô‡∏•‡∏π‡∏õ‡∏ú‡πà‡∏≤‡∏ô‡πÑ‡∏ü‡∏•‡πå‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡πÉ‡∏ô‡πÇ‡∏ü‡∏•‡πÄ‡∏î‡∏≠‡∏£‡πå
for file in os.listdir(test_folder):
    if file.endswith(".wav"):
        file_path = os.path.join(test_folder, file)

        # ‡∏î‡∏∂‡∏á‡∏ü‡∏µ‡πÄ‡∏à‡∏≠‡∏£‡πå
        features = extract_features(file_path)
        features = features.reshape(1, -1)  # Reshape ‡πÉ‡∏´‡πâ‡πÄ‡∏Ç‡πâ‡∏≤‡∏Å‡∏±‡∏ö‡πÇ‡∏°‡πÄ‡∏î‡∏•

# ‡∏ó‡∏≥‡∏Å‡∏≤‡∏£‡∏û‡∏¢‡∏≤‡∏Å‡∏£‡∏ì‡πå‡πÅ‡∏ô‡∏ß‡πÄ‡∏û‡∏•‡∏á
prediction = model.predict(features)

# Access the predicted label directly
predicted_label = prediction[0]

print(f"üéµ ‡πÑ‡∏ü‡∏•‡πå: {file} ‚Üí ‡∏ó‡∏≥‡∏ô‡∏≤‡∏¢‡∏ß‡πà‡∏≤‡πÄ‡∏õ‡πá‡∏ô‡πÅ‡∏ô‡∏ß‡πÄ‡∏û‡∏•‡∏á: {predicted_label}")